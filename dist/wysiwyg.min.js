"use strict";!function(angular){var getSelectionBoundaryElement=function(win,isStart){var range,sel,container=null,doc=win.document;return doc.selection?(range=doc.selection.createRange(),range.collapse(isStart),range.parentElement()):(doc.getSelection?(sel=doc.getSelection(),sel.rangeCount>0&&(range=sel.getRangeAt(0),container=range[isStart?"startContainer":"endContainer"],3===container.nodeType&&(container=container.parentNode))):win.getSelection&&(sel=win.getSelection(),sel.rangeCount>0&&(range=sel.getRangeAt(0),container=range[isStart?"startContainer":"endContainer"],3===container.nodeType&&(container=container.parentNode))),container)};angular.module("ngWYSIWYG",["ngSanitize"]);var editorTemplate='<div class="tinyeditor"><div class="tinyeditor-header" ng-hide="editMode">{toolbar}<div style="clear: both;"></div></div><div class="sizer" ce-resize><textarea data-placeholder-attr="" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; resize: none; width: 100%; height: 100%;" ng-show="editMode" ng-model="content"></textarea><iframe style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; width: 100%; height: 100%;" ng-hide="editMode" wframe="{sanitize: config.sanitize}" content-style="{contentStyle}" ng-model="content"></iframe></div><div class="tinyeditor-footer"><div ng-switch="editMode" ng-click="editMode = !editMode" class="toggle"><span ng-switch-when="true">wysiwyg</span><span ng-switch-default>source</span></div></div></div>';angular.module("ngWYSIWYG").config(["$provide",function($provide){$provide.decorator("$sanitize",function($delegate,$log){return function(text,target){var result=$delegate(text,target);return result}})}]),angular.module("ngWYSIWYG").directive("wframe",["$compile","$timeout","$sanitize",function($compile,$timeout,$sanitize){var linker=function(scope,$element,attrs,ctrl){var $document=$element[0].contentDocument;$document.open(),$document.write('<!DOCTYPE html><html><head></head><body contenteditable="true"></body></html>'),$document.close(),$document.designMode="On";var $body=angular.element($element[0].contentDocument.body),$head=angular.element($element[0].contentDocument.head);$body.attr("contenteditable","true"),$document.addEventListener("click",function(event){"HTML"===event.target.tagName&&event.target.querySelector("body").focus()}),attrs.contentStyle&&$head.append('<link rel="stylesheet" type="text/css" href="'+attrs.contentStyle+'">'),ctrl.$render=function(){console.log(scope.config),$body[0].innerHTML=ctrl.$viewValue?scope.config&&scope.config.sanitize?$sanitize(ctrl.$viewValue):ctrl.$viewValue:""},scope.sync=function(){scope.$evalAsync(function(scope){ctrl.$setViewValue($body.html())})};var debounce=null;$body.bind("click keyup change paste",function(){debounce&&$timeout.cancel(debounce),debounce=$timeout(function(){ctrl.$setViewValue($body.html());var el=getSelectionBoundaryElement($element[0].contentWindow,!0);if(el){var computedStyle=$element[0].contentWindow.getComputedStyle(el),elementStyle={bold:"bold"==computedStyle.getPropertyValue("font-weight")||parseInt(computedStyle.getPropertyValue("font-weight"))>=700,italic:"italic"==computedStyle.getPropertyValue("font-style"),underline:"underline"==computedStyle.getPropertyValue("text-decoration"),strikethrough:"line-through"==computedStyle.getPropertyValue("text-decoration"),font:computedStyle.getPropertyValue("font-family"),size:parseInt(computedStyle.getPropertyValue("font-size")),color:computedStyle.getPropertyValue("color"),sub:"sub"==computedStyle.getPropertyValue("vertical-align"),"super":"super"==computedStyle.getPropertyValue("vertical-align"),background:computedStyle.getPropertyValue("background-color"),alignment:computedStyle.getPropertyValue("text-align")};scope.$emit("cursor-position",elementStyle)}},100,!0)}),scope.range=null,scope.getSelection=function(){if($document.getSelection){var sel=$document.getSelection();sel.getRangeAt&&sel.rangeCount&&(scope.range=sel.getRangeAt(0))}},scope.restoreSelection=function(){if(scope.range&&$document.getSelection){var sel=$document.getSelection();sel.removeAllRanges(),sel.addRange(scope.range)}},scope.$on("execCommand",function(e,cmd){console.log("execCommand: "),console.log(cmd),$element[0].contentDocument.body.focus();var sel=$document.selection;if(sel){var textRange=sel.createRange();$document.execCommand(cmd.command,0,cmd.arg),textRange.collapse(!1),textRange.select()}else $document.execCommand(cmd.command,0,cmd.arg);$document.body.focus(),scope.sync()}),scope.$on("$destroy",function(){});try{$document.execCommand("styleWithCSS",0,0),$document.execCommand("enableObjectResizing",0,!0),$document.execCommand("contentReadOnly",0,"false")}catch(e){try{$document.execCommand("useCSS",0,1)}catch(e){}}};return{link:linker,require:"ngModel",scope:{config:"=wframe"},replace:!0,restrict:"AE"}}]),angular.module("ngWYSIWYG").directive("ceResize",["$document",function($document){return function($scope,$element,$attr){var $mouseDown,resizeDown=function($event){var margin=50,uppest=$element[0].offsetTop+margin,height=$event.pageY>uppest?$event.pageY-$element[0].offsetTop:margin;$element.css({height:height+"px"})},createResizer=function(className,handlers){var newElement=angular.element('<span class="'+className+'"></span>');$element.append(newElement),newElement.on("mousedown",function($event){function mousemove($event){$event.preventDefault();for(var i=0;i<handlers.length;i++)handlers[i]($event)}function mouseup(){$document.off("mousemove",mousemove),$document.off("mouseup",mouseup)}$document.on("mousemove",mousemove),$document.on("mouseup",mouseup),$mouseDown=$event,$mouseDown.top=$element[0].offsetTop,$mouseDown.left=$element[0].offsetLeft,$mouseDown.width=$element[0].offsetWidth,$mouseDown.height=$element[0].offsetHeight})};createResizer("resizer",[resizeDown,resizeDown])}}]),angular.module("ngWYSIWYG").directive("colorsGrid",["$compile","$document",function($compile,$document){var linker=function(scope,element,attrs,ctrl){$document.on("click",function(){scope.$apply(function(){scope.show=!1})}),element.parent().bind("click",function(e){e.stopPropagation()}),scope.colors=["#000000","#993300","#333300","#003300","#003366","#000080","#333399","#333333","#800000","#FF6600","#808000","#008000","#008080","#0000FF","#666699","#808080","#FF0000","#FF9900","#99CC00","#339966","#33CCCC","#3366FF","#800080","#999999","#FF00FF","#FFCC00","#FFFF00","#00FF00","#00FFFF","#00CCFF","#993366","#C0C0C0","#FF99CC","#FFCC99","#FFFF99","#CCFFCC","#CCFFFF","#99CCFF","#CC99FF","#FFFFFF"],scope.pick=function(color){scope.onPick({color:color})},element.ready(function(){function makeUnselectable(node){1==node.nodeType&&(node.setAttribute("unselectable","on"),node.unselectable="on");for(var child=node.firstChild;child;)makeUnselectable(child),child=child.nextSibling}for(var i=0;i<document.getElementsByClassName("colors-grid").length;i+=1)makeUnselectable(document.getElementsByClassName("colors-grid")[i])})};return{link:linker,scope:{show:"=",onPick:"&"},restrict:"AE",template:'<ul ng-show="show" class="colors-grid"><li ng-style="{\'background-color\': color}" title: "{{color}}" ng-repeat="color in colors" unselectable="on" ng-click="pick(color)"></li></ul>'}}]),angular.module("ngWYSIWYG").directive("symbolsGrid",["$compile","$document","$sce",function($compile,$document,$sce){var linker=function(scope,element,attrs,ctrl){$document.on("click",function(){scope.$apply(function(){scope.show=!1})}),element.parent().bind("click",function(e){e.stopPropagation()}),scope.symbols=["&iexcl;","&iquest;","&ndash;","&mdash;","&raquo;","&laquo;","&copy;","&divide;","&micro;","&para;","&plusmn;","&cent;","&euro;","&pound;","&reg;","&sect;","&trade;","&yen;","&deg;","&forall;","&part;","&exist;","&empty;","&nabla;","&isin;","&notin;","&ni;","&prod;","&sum;","&uarr;","&rarr;","&darr;","&spades;","&clubs;","&hearts;","&diams;","&aacute;","&agrave;","&acirc;","&aring;","&atilde;","&auml;","&aelig;","&ccedil;","&eacute;","&egrave;","&ecirc;","&euml;","&iacute;","&igrave;","&icirc;","&iuml;","&ntilde;","&oacute;","&ograve;","&ocirc;","&oslash;","&otilde;","&ouml;","&szlig;","&uacute;","&ugrave;","&ucirc;","&uuml;","&yuml;"],scope.pick=function(symbol){scope.onPick({symbol:symbol})},element.ready(function(){function makeUnselectable(node){1==node.nodeType&&(node.setAttribute("unselectable","on"),node.unselectable="on");for(var child=node.firstChild;child;)makeUnselectable(child),child=child.nextSibling}for(var i=0;i<document.getElementsByClassName("symbols-grid").length;i+=1)makeUnselectable(document.getElementsByClassName("symbols-grid")[i])})};return{link:linker,scope:{show:"=",onPick:"&"},restrict:"AE",template:'<ul ng-show="show" class="symbols-grid"><li ng-repeat="symbol in symbols" unselectable="on" ng-click="pick(symbol)" ng-bind-html="symbol"></li></ul>'}}]),angular.module("ngWYSIWYG").directive("wysiwygEdit",["$compile","$timeout","$q",function($compile,$timeout,$q){var linker=function(scope,$element,attrs,ctrl){function loadVars(){null==iframe&&(iframe=document.querySelector("wysiwyg-edit").querySelector("iframe"),iframeDocument=iframe.contentDocument,iframeWindow=iframeDocument.defaultView)}function getButtonHtml(button){var html="<"+button.type;if(html+=' class="'+button["class"],usingFontAwesome&&(html+=" tinyeditor-control-fa"),html+='" ',"div"==button.type){if(button.title&&(html+='title="'+button.title+'" '),button.backgroundPos&&!usingFontAwesome&&(html+='style="background-position: '+button.backgroundPos+'; position: relative;" '),button.pressed&&(html+="ng-class=\"{'pressed': cursorStyle."+button.pressed+'}" '),button.command){var executable="'"+button.command+"'";button.commandParameter&&(executable+=", '"+button.commandParameter+"'"),html+='ng-click="execCommand('+executable+')" '}else button.specialCommand&&(html+='ng-click="'+button.specialCommand+'" ');html+=">",button.faIcon&&usingFontAwesome&&"-"!=button.faIcon&&(html+='<i class="fa fa-'+button.faIcon+'"></i>'),button.faIcon&&usingFontAwesome&&"-"==button.faIcon&&(html+='<div class="hr"></div>'),button.inner&&(html+=button.inner)}else"select"==button.type&&(html+='ng-model="'+button.model+'" ',html+='ng-options="'+button.options+'" ',html+='ng-change="'+button.change+'" ',html+='<option value="">'+button.title+"</option>");return html+="</"+button.type+">"}scope.editMode=!1,scope.cursorStyle={};var iframe=null,iframeDocument=null,iframeWindow=null;scope.panelButtons={"-":{type:"div","class":"tinyeditor-divider"},bold:{type:"div",title:"Bold","class":"tinyeditor-control",faIcon:"bold",backgroundPos:"34px -120px",pressed:"bold",command:"bold"},italic:{type:"div",title:"Italic","class":"tinyeditor-control",faIcon:"italic",backgroundPos:"34px -150px",pressed:"italic",command:"italic"},underline:{type:"div",title:"Underline","class":"tinyeditor-control",faIcon:"underline",backgroundPos:"34px -180px",pressed:"underline",command:"underline"},strikethrough:{type:"div",title:"Strikethrough","class":"tinyeditor-control",faIcon:"strikethrough",backgroundPos:"34px -210px",pressed:"strikethrough",command:"strikethrough"},subscript:{type:"div",title:"Subscript","class":"tinyeditor-control",faIcon:"subscript",backgroundPos:"34px -240px",pressed:"sub",command:"subscript"},superscript:{type:"div",title:"Superscript","class":"tinyeditor-control",faIcon:"superscript",backgroundPos:"34px -270px",pressed:"super",command:"superscript"},leftAlign:{type:"div",title:"Left Align","class":"tinyeditor-control",faIcon:"align-left",backgroundPos:"34px -420px",pressed:"alignmet == 'left'",command:"justifyleft"},centerAlign:{type:"div",title:"Center Align","class":"tinyeditor-control",faIcon:"align-center",backgroundPos:"34px -450px",pressed:"alignment == 'center'",command:"justifycenter"},rightAlign:{type:"div",title:"Right Align","class":"tinyeditor-control",faIcon:"align-right",backgroundPos:"34px -480px",pressed:"alignment == 'right'",command:"justifyright"},blockJustify:{type:"div",title:"Block Justify","class":"tinyeditor-control",faIcon:"align-justify",backgroundPos:"34px -510px",pressed:"alignment == 'justify'",command:"justifyfull"},orderedList:{type:"div",title:"Insert Ordered List","class":"tinyeditor-control",faIcon:"list-ol",backgroundPos:"34px -300px",command:"insertorderedlist"},unorderedList:{type:"div",title:"Insert Unordered List","class":"tinyeditor-control",faIcon:"list-ul",backgroundPos:"34px -330px",command:"insertunorderedlist"},outdent:{type:"div",title:"Outdent","class":"tinyeditor-control",faIcon:"outdent",backgroundPos:"34px -360px",command:"outdent"},indent:{type:"div",title:"Indent","class":"tinyeditor-control",faIcon:"indent",backgroundPos:"34px -390px",command:"indent"},removeFormatting:{type:"div",title:"Remove Formatting","class":"tinyeditor-control",faIcon:"eraser",backgroundPos:"34px -720px",command:"removeformat"},undo:{type:"div",title:"Undo","class":"tinyeditor-control",faIcon:"undo",backgroundPos:"34px -540px",command:"undo"},redo:{type:"div",title:"Redo","class":"tinyeditor-control",faIcon:"repeat",backgroundPos:"34px -570px",command:"redo"},fontColor:{type:"div",title:"Font Color","class":"tinyeditor-control",faIcon:"font",backgroundPos:"34px -779px",specialCommand:"showFontColors = !showFontColors",inner:'<colors-grid show="showFontColors" on-pick="setFontColor(color)"><colors-grid>'},backgroundColor:{type:"div",title:"Background Color","class":"tinyeditor-control",faIcon:"paint-brush",backgroundPos:"34px -808px",specialCommand:"showBgColors = !showBgColors",inner:'<colors-grid show="showBgColors" on-pick="setBgColor(color)"><colors-grid>'},image:{type:"div",title:"Insert Image","class":"tinyeditor-control",faIcon:"picture-o",backgroundPos:"34px -600px",specialCommand:"insertImage()"},hr:{type:"div",title:"Insert Horizontal Rule","class":"tinyeditor-control",faIcon:"-",backgroundPos:"34px -630px",command:"inserthorizontalrule"},symbols:{type:"div",title:"Insert Special Symbol","class":"tinyeditor-control",faIcon:"cny",backgroundPos:"34px -838px",specialCommand:"showSpecChars = !showSpecChars",inner:'<symbols-grid show="showSpecChars" on-pick="insertSpecChar(symbol)"><symbols-grid>'},link:{type:"div",title:"Insert Hyperlink","class":"tinyeditor-control",faIcon:"link",backgroundPos:"34px -660px",specialCommand:"insertLink()"},unlink:{type:"div",title:"Remove Hyperlink","class":"tinyeditor-control",faIcon:"chain-broken",backgroundPos:"34px -690px",command:"unlink"},print:{type:"div",title:"Print","class":"tinyeditor-control",faIcon:"print",backgroundPos:"34px -750px",command:"print"},font:{type:"select",title:"Font","class":"tinyeditor-font",model:"font",options:"a as a for a in fonts",change:"fontChange()"},size:{type:"select",title:"Size","class":"tinyeditor-size",model:"fontsize",options:"a.key as a.name for a in fontsizes",change:"sizeChange()"},format:{type:"select",title:"Style","class":"tinyeditor-size",model:"textstyle",options:"s.key as s.name for s in styles",change:"styleChange()"}};var usingFontAwesome=scope.config&&scope.config.fontAwesome;scope.toolbar=scope.config&&scope.config.toolbar?scope.config.toolbar:[{name:"basicStyling",items:["bold","italic","underline","strikethrough","subscript","superscript","leftAlign","centerAlign","rightAlign","blockJustify","-"]},{name:"paragraph",items:["orderedList","unorderedList","outdent","indent","-"]},{name:"doers",items:["removeFormatting","undo","redo","-"]},{name:"colors",items:["fontColor","backgroundColor","-"]},{name:"links",items:["image","hr","symbols","link","unlink","-"]},{name:"tools",items:["print","-"]},{name:"styling",items:["font","size","format"]}];var toolbarGroups=[];angular.forEach(scope.toolbar,function(buttonGroup,index){var buttons=[];angular.forEach(buttonGroup.items,function(button,index){var newButton=scope.panelButtons[button];newButton||(newButton=scope.config.buttons[button]),this.push(getButtonHtml(newButton))},buttons),this.push('<div class="tinyeditor-buttons-group">'+buttons.join("")+"</div>")},toolbarGroups);var template=editorTemplate.replace("{toolbar}",toolbarGroups.join(""));template=template.replace("{contentStyle}",attrs.contentStyle||""),$element.html(template),$compile($element.contents())(scope),scope.execCommand=function(cmd,arg){switch(cmd){case"bold":scope.cursorStyle.bold=!scope.cursorStyle.bold;break;case"italic":scope.cursorStyle.italic=!scope.cursorStyle.italic;break;case"underline":scope.cursorStyle.underline=!scope.cursorStyle.underline;break;case"strikethrough":scope.cursorStyle.strikethrough=!scope.cursorStyle.strikethrough;break;case"subscript":scope.cursorStyle.sub=!scope.cursorStyle.sub;break;case"superscript":scope.cursorStyle["super"]=!scope.cursorStyle["super"];break;case"justifyleft":scope.cursorStyle.alignment="left";break;case"justifycenter":scope.cursorStyle.alignment="center";break;case"justifyright":scope.cursorStyle.alignment="right";break;case"justifyfull":scope.cursorStyle.alignment="justify"}scope.$broadcast("execCommand",{command:cmd,arg:arg})},scope.fonts=["Verdana","Arial","Arial Black","Arial Narrow","Courier New","Century Gothic","Comic Sans MS","Georgia","Impact","Tahoma","Times","Times New Roman","Webdings","Trebuchet MS"],scope.fontChange=function(){scope.execCommand("fontname",scope.font)},scope.fontsizes=[{key:1,name:"x-small"},{key:2,name:"small"},{key:3,name:"normal"},{key:4,name:"large"},{key:5,name:"x-large"},{key:6,name:"xx-large"},{key:7,name:"xxx-large"}],scope.mapFontSize={10:1,13:2,16:3,18:4,24:5,32:6,48:7},scope.sizeChange=function(){scope.execCommand("fontsize",scope.fontsize)},scope.styles=[{name:"Paragraph",key:"<p>"},{name:"Header 1",key:"<h1>"},{name:"Header 2",key:"<h2>"},{name:"Header 3",key:"<h3>"},{name:"Header 4",key:"<h4>"},{name:"Header 5",key:"<h5>"},{name:"Header 6",key:"<h6>"}],scope.styleChange=function(){scope.execCommand("formatblock",scope.fontsize)},scope.showFontColors=!1,scope.setFontColor=function(color){scope.execCommand("foreColor",color)},scope.showBgColors=!1,scope.setBgColor=function(color){scope.execCommand("hiliteColor",color)},scope.showSpecChars=!1,scope.insertSpecChar=function(symbol){scope.execCommand("insertHTML",symbol)},scope.insertLink=function(){if(loadVars(),null!=iframeWindow.getSelection().focusNode){var elementBeingEdited=getSelectionBoundaryElement(iframeWindow,!0),defaultUrl="http://";if(elementBeingEdited&&"A"==elementBeingEdited.nodeName){defaultUrl=elementBeingEdited.href;var selectRange=iframeDocument.createRange();selectRange.setStart(elementBeingEdited.firstChild,0),selectRange.setEnd(elementBeingEdited.firstChild,elementBeingEdited.firstChild.length);var selection=iframeWindow.getSelection();selection.removeAllRanges(),selection.addRange(selectRange)}var val;val=scope.api&&scope.api.insertLink&&angular.isFunction(scope.api.insertLink)?scope.api.insertLink.apply(scope.api.scope||null,[defaultUrl]):prompt("Please enter the URL","http://"),$q.when(val).then(function(data){scope.execCommand("createlink",data)})}},scope.insertImage=function(){var val;scope.api&&scope.api.insertImage&&angular.isFunction(scope.api.insertImage)?val=scope.api.insertImage.apply(scope.api.scope||null):(val=prompt("Please enter the picture URL","http://"),val='<img src="'+val+'">'),$q.when(val).then(function(data){scope.execCommand("insertHTML",data)})},$element.ready(function(){function makeUnselectable(node){1==node.nodeType&&(node.setAttribute("unselectable","on"),node.unselectable="on");for(var child=node.firstChild;child;)makeUnselectable(child),child=child.nextSibling}for(var i=0;i<document.getElementsByClassName("tinyeditor-header").length;i+=1)makeUnselectable(document.getElementsByClassName("tinyeditor-header")[i])}),scope.$on("cursor-position",function(event,data){scope.cursorStyle=data,scope.font=data.font.replace(/(')/g,""),scope.fontsize=scope.mapFontSize[data.size]?scope.mapFontSize[data.size]:0})};return{link:linker,scope:{content:"=",api:"=",config:"="},restrict:"AE",replace:!0}}])}(window.angular);